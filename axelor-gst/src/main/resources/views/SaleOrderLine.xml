<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

	<form name="sale-order-line-form" title="SO line"
		model="com.axelor.apps.sale.db.SaleOrderLine"
		onLoad="action-group-sale-saleorderline-onload,action-sale-order-line-attrs-hidden-fields-for-client"
		onNew="action-group-sale-saleorderline-onnew" width="large"
		id="sale-order-line-form-id">

		<panel name="productPanel" showIf="typeSelect == 1">
			<field name="productName" colSpan="9" title="Title" />
			<field name="typeSelect" colSpan="3"
				onChange="action-sale-order-line-method-empty-line,action-sale-order-attrs-hide-ati"
				selection-in="[0,1]" />
		</panel>

		<panel-tabs name="mainPanelTab" hideIf="typeSelect == 1">
			<panel name="informationsPanel" title="Information">
				<!-- The condition $isReadOnly !== false is used to manage the case where 
					isReadOnly is null. -->
				<panel name="productInfoPanel" colSpan="12"
					readonlyIf="$isReadOnly !== false">
					<panel name="tagPanel" colSpan="12">
						<field name="$viewerTag" showTitle="false"
							showIf="product != null" readonly="true" colSpan="2">
							<viewer depends="product.isUnrenewed,product.isPrototype"><![CDATA[
					 	<h4>
	                        <span class="label label-important" ng-show="record.product.isUnrenewed" x-translate>Unrenewed</span>
	                        <span class="label label-important" ng-show="record.product.isPrototype" x-translate>Prototype</span>
	                    </h4>
					]]>
					</viewer>
						</field>
						<field name="invoiced" showTitle="false"
							showIf="id &amp;&amp; $readonly() &amp;&amp; exTaxTotal > 0"
							colSpan="2" if-module="axelor-supplychain"
							if="__config__.app.isApp('supplychain')">
							<viewer depends="amountInvoiced,exTaxTotal"><![CDATA[
                        <h4>
                            <span class="label label-success" ng-show="record.amountInvoiced > 0 && record.amountInvoiced == record.exTaxTotal" x-translate>Invoiced</span>
                            <span class="label label-warning" ng-show="record.amountInvoiced > 0 && $number(record.amountInvoiced) < $number(record.exTaxTotal)" x-translate>Partially invoiced</span>
                            <span class="label label-important" ng-show="record.amountInvoiced == 0" x-translate>Not invoiced</span>
                        </h4>
                    ]]>
					</viewer>
						</field>
						<field name="deliveryState" showTitle="false" colSpan="2"
							showIf="deliveryState > 0" if-module="axelor-supplychain"
							if="__config__.app.isApp('supplychain')">
							<viewer><![CDATA[
	                    <h4>
	                        <span class="label label-important" ng-show="record.deliveryState == 1" x-translate>Not delivered</span>
	                        <span class="label label-warning" ng-show="record.deliveryState == 2" x-translate>Partially delivered</span>
	                        <span class="label label-success" ng-show="record.deliveryState == 3" x-translate>Delivered</span>
	                    </h4>
					]]></viewer>
						</field>
						<field name="$availabiltyRequest"
							showIf="$availabiltyRequest" showTitle="false" type="boolean"
							colSpan="2" if-module="axelor-supplychain"
							if="__config__.app.isApp('supplychain')">
							<viewer><![CDATA[
						<h4>
							<span class="label label-success" ng-show="record.$availabiltyRequest" x-translate>Availability request</span>
						</h4>
					]]></viewer>
						</field>

						<field name="isQtyRequested" showTitle="false" colSpan="2"
							showIf="isQtyRequested" if-module="axelor-supplychain"
							if="__config__.app.isApp('supplychain')">
							<viewer><![CDATA[
						<h4>
							<span class="label label-success" ng-show="record.isQtyRequested" x-translate>Reservation requested</span>
						</h4>
					]]></viewer>
						</field>

					</panel>
					<field name="product.isUnrenewed" hidden="true" />
					<field name="product.isPrototype" hidden="true" />
					<spacer name="viewerSpacer"
						if="__config__.app.isApp('supplychain')" />
					<field name="product" canEdit="false"
						onChange="action-group-sale-saleorderline-product-onchange"
						onSelect="action-sale-order-line-attrs-domain-product"
						form-view="product-form" grid-view="product-grid"
						if="!__config__.app.isApp('supplychain')" />
					<field name="product" canEdit="false"
						onChange="action-group-sale-saleorderline-product-onchange"
						onSelect="action-sale-order-line-attrs-domain-product"
						form-view="product-form" grid-view="stock-move-line-product-grid"
						if="__config__.app.isApp('supplychain')" />
					<field name="typeSelect" colSpan="2"
						onChange="action-sale-order-line-method-empty-line,action-sale-order-attrs-hide-ati"
						selection-in="[0,1]" />
					<field name="packPriceSelect"
						showIf="typeSelect == 2 &amp;&amp; product != null" colSpan="4"
						onChange="action-group-sale-order-line-pack-price-select-onchange"
						if="(__config__.app.isApp('sale') &amp;&amp; __config__.app.getApp('sale').getProductPackMgt())" />
					<field name="productName" colSpan="6" />
					<field name="hsbn" colSpan="3" />
					<field name="oldQty" />
				</panel>
				<panel name="productDetailPanel" colSpan="12"
					readonlyIf="$isReadOnly !== false">
					<field name="qty" colSpan="3"
						onChange="action-group-sale-saleorderline-qty-onchange"
						readonlyIf="isSubLine" validIf="$qtyValid != false" />
					<field name="unit" colSpan="3"
						readonlyIf="typeSelect == 2 || isSubLine" canEdit="false"
						form-view="unit-form" grid-view="unit-grid" />
					<field name="price" colSpan="3"
						onChange="action-sale-order-line-method-onchange-price,action-sale-order-line-method-compute,action-sale-order-line-method-compute-analytic-distribution"
						hidden="true" />

					<field name="inTaxPrice" colSpan="3"
						onChange="action-sale-order-line-method-onchange-intaxprice,action-sale-order-line-method-compute,action-sale-order-line-method-compute-analytic-distribution"
						hidden="true" />
					<panel name="discountPanel" colSpan="12">
						<field name="discountTypeSelect" colSpan="3"
							onChange="action-sale-order-line-method-compute,action-sale-order-line-attrs-discountamount-title,action-sale-order-line-method-compute-analytic-distribution" />
						<field name="discountAmount" colSpan="3"
							onChange="action-sale-order-line-method-compute,action-sale-order-line-method-compute-analytic-distribution"
							hideIf="discountTypeSelect == 3" />
						<field name="priceDiscounted" colSpan="3" hidden="true"
							readonly="true" />
					</panel>
					<label name="multipleQtyNotRespectedLabel" hidden="true"
						colSpan="12" />
					<field name="$qtyValid" hidden="true" colSpan="12" />
				</panel>

				<panel name="taxPanel" colSpan="12">
					<field name="taxLine" canEdit="false" colSpan="6"
						readonlyIf="$isReadOnly !== false"
						onChange="action-group-sale-saleorderline-tax-line-onchange"
						domain="self.endDate = null or self.endDate &gt; :__date__"
						grid-view="tax-line-grid" form-view="tax-line-form" />
					<field name="exTaxTotal" readonly="true" colSpan="3" />
					<field name="gstRate" />
					<field name="igst" />
					<field name="sgst" />
					<field name="cgst" />
					<field name="grossAmount" />
					<field name="inTaxTotal" readonly="true" colSpan="3" />
					<field name="isSubLine" hideIf="!isSubLine"
						readonlyIf="$isReadOnly !== false"
						if="(__config__.app.isApp('sale') &amp;&amp; __config__.app.getApp('sale').getProductPackMgt())" />
					<field name="parentLine"
						hideIf="!isSubLine || parentLine == null"
						readonlyIf="$isReadOnly !== false" />
				</panel>
				<panel name="reservationPanel" colSpan="12"
					if-module="axelor-supplychain"
					if="__config__.app.isApp('supplychain')">
					<field name="requestedReservedQty" colSpan="6" hidden="true"
						if-module="axelor-supplychain"
						onChange="action-supplychain-attrs-sale-order-line-max-requested-reserved-qty"
						if="__config__.app.getApp('supplychain').getManageStockReservation()" />
					<field name="reservedQty" colSpan="6" readonly="true"
						hidden="true" if-module="axelor-supplychain"
						if="__config__.app.getApp('supplychain').getManageStockReservation()" />
					<field hidden="true" name="isQtyRequested" />
					<panel name="requestedQtyBtnsPanel" colSpan="12"
						if-module="axelor-supplychain"
						if="__config__.app.getApp('supplychain').getManageStockReservation()">
						<button name="updateRequestedReservedQtyBtn" colSpan="6"
							hidden="true" title="Change requested reserved qty"
							onClick="action-view-sale-order-line-requested-reserved-qty-wizard" />
					</panel>
					<panel name="reservedQtyBtnsPanel" colSpan="12"
						if-module="axelor-supplychain"
						if="__config__.app.getApp('supplychain').getManageStockReservation()">
						<button name="updateAllocatedQtyBtn" colSpan="6"
							hidden="true" title="Change allocated qty"
							onClick="action-view-sale-order-line-allocated-qty-wizard" />
					</panel>
					<panel name="requestedReservedQtyBtnqPanel" colSpan="12"
						if-module="axelor-supplychain"
						if="__config__.app.getApp('supplychain').getManageStockReservation()">
						<button name="requestQty" title="Request reservation"
							showIf="!isQtyRequested"
							onClick="save,action-method-sale-order-line-request-qty" />
					</panel>
					<panel name="cancelReservedQtyBtnqPanel" colSpan="12"
						if-module="axelor-supplychain"
						if="__config__.app.getApp('supplychain').getManageStockReservation()">
						<button name="cancelReservation" title="Cancel reservation"
							showIf="isQtyRequested"
							onClick="save,action-method-sale-order-line-cancel-reservation" />
					</panel>
				</panel>
				<spacer />
				<field name="$availableStock" colSpan="3" readonly="true"
					type="decimal" title="Available stock"
					if-module="axelor-supplychain"
					if="__config__.app.getApp('supplychain').getManageStockReservation()" />
				<field name="$allocatedStock" colSpan="3" readonly="true"
					type="decimal" title="Allocated stock"
					if-module="axelor-supplychain"
					if="__config__.app.getApp('supplychain').getManageStockReservation()" />
				<field name="$totalStock" colSpan="3" readonly="true"
					type="decimal" title="Total stock" if-module="axelor-supplychain"
					if="__config__.app.getApp('supplychain').getManageStockReservation()" />
				<field name="taxEquiv" hidden="true"
					grid-view="tax-equiv-grid" form-view="tax-equiv-form" />
				<panel name="descriptionPanel" title="Description"
					colSpan="12" readonlyIf="$isReadOnly !== false">
					<field name="description" showTitle="false" colSpan="12"
						widget="Html" x-lite="true" />
				</panel>
				<field name="$isReadOnly" hidden="true" />
			</panel>
			<panel name="packPanel" title="Pack lines"
				showIf="typeSelect == 2"
				readonlyIf="packPriceSelect == 0 || $isReadOnly !== false"
				if="__config__.app.isApp('sale') &amp;&amp; __config__.app.getApp('sale').getProductPackMgt()">
				<panel-related name="subLineListPanel"
					field="subLineList"
					onChange="action-sale-order-line-compute-total-pack" colSpan="12"
					form-view="sale-order-line-form" grid-view="sale-order-line-grid"
					canNew="false" canRemove="false" />
				<field name="totalPack" readonly="true" />
			</panel>
			<panel name="marginPanel" title="Margin"
				readonlyIf="$isReadOnly !== false">
				<field name="subTotalCostPrice"
					onChange="action-sale-order-line-method-compute-subMargin" />
				<field name="subTotalGrossMargin" readonly="true" />
				<field name="subMarginRate" readonly="true" />
				<field name="subTotalMarkup" readonly="true" />
				<field name="$companyCurrency" readonly="true"
					title="Currency" type="many-to-one"
					target="com.axelor.apps.base.db.Currency" />
			</panel>
			<panel name="deliveryPanel" title="Delivery">
				<field name="desiredDelivDate"
					readonlyIf="$isReadOnly !== false" />
				<field name="estimatedDelivDate"
					readonlyIf="$isReadOnly !== false" />
				<field name="deliveredQty" readonly="true"
					readonlyIf="$isReadOnly !== false" />
				<button name="$futureQtyBtn" title="Future qty"
					icon="fa-line-chart" colSpan="3"
					onClick="action-view-sale-order-line-view-planned-stock-move-lines"
					widget="info-button" if-module="axelor-supplychain" />
				<field name="pickingOrderInfo" colSpan="12"
					if-module="axelor-supplychain"
					if="__config__.app.isApp('supplychain')"
					readonlyIf="$isReadOnly !== false" />
				<panel-dashlet name="stockMoveLineOfSOPanel"
					title="Stock Moves"
					action="action-sale-order-line-view-stock-move-line" colSpan="12"
					if-module="axelor-supplychain"
					if="__config__.app.isApp('supplychain')"
					readonlyIf="$isReadOnly !== false" />
			</panel>
			<panel name="invoicingFollowUpPanel" title="Invoicing"
				readonlyIf="$isReadOnly !== false" if-module="axelor-supplychain"
				if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getManageInvoicedAmountByLine()">
				<field name="invoicingDate" />
				<field name="amountInvoiced" />
				<panel-dashlet name="invoiceLinesFromSOLinePanel"
					action="action-sale-order-line-view-show-invoice-lines"
					colSpan="12" />
			</panel>
			<panel name="projectPanel"
				if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getProjectSaleOrderLines()"
				title="Business Project" readonlyIf="$isReadOnly !== false"
				if-module="axelor-business-project">
				<field name="project" title="Business Project" canEdit="false"
					onSelect="action-sale-order-line-attrs-domain-project"
					onChange="action-sale-order-line-record-progress"
					form-view="project-form" grid-view="project-grid" />
				<field name="toInvoice" colSpan="3"
					if="__config__.app.isApp('business-project') &amp;&amp; __config__.app.getApp('business-project').getProjectSaleOrderLines()"
					if-module="axelor-business-project" />
			</panel>
			<panel name="analyticDistributionPanel" title="Analytics"
				if-module="axelor-supplychain"
				if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('account').getManageAnalyticAccounting()"
				onTabSelect="action-sale-order-line-attrs-read-only-distribution-lines">
				<field name="analyticDistributionTemplate"
					grid-view="analytic-distribution-template-grid"
					form-view="analytic-distribution-template-form" canEdit="false"
					onChange="action-sale-order-line-method-create-distribution"
					onSelect="action-sale-order-line-attrs-set-domain-analytic-distribution-template" />
				<panel-related name="analyticMoveLineListPanel"
					readonlyIf="$isReadOnly !== false" field="analyticMoveLineList"
					grid-view="analytic-move-line-distribution-grid"
					form-view="analytic-move-line-distribution-form" colSpan="12" />
			</panel>
			<panel name="settingsPanel" readonlyIf="$isReadOnly !== false"
				title="Configuration">
				<field name="saleSupplySelect"
					onChange="action-group-sale-saleorderline-salesupplyselect-onchange"
					if-module="axelor-supplychain"
					if="__config__.app.isApp('supplychain')" />
				<field name="standardDelay" if-module="axelor-supplychain"
					if="__config__.app.isApp('supplychain')" hidden="true"
					showIf="saleSupplySelect == 2 || saleSupplySelect ==3" />
				<field name="supplierPartner" showIf="saleSupplySelect == 2"
					onSelect="action-sale-order-line-method-supplier-partner-domain"
					form-view="partner-form" grid-view="partner-grid" />
				<field name="billOfMaterial"
					onSelect="action-sale-order-line-attrs-bill-of-material-domain"
					if-module="axelor-production" form-view="bill-of-material-form"
					grid-view="bill-of-material-grid"
					if="__config__.app.isApp('production')" />
				<button name="customizeBOMBtn" title="Customize BOM"
					onClick="action-production-method-customize-bill-of-material"
					if-module="axelor-production"
					if="__config__.app.isApp('production')" />
			</panel>
		</panel-tabs>
		<panel name="attrsPanel">
			<field name="attrs" colSpan="12" />
		</panel>
		<panel name="statusPanel" hidden="true">
			<field name="saleOrder.statusSelect" />
			<field name="saleOrder.orderBeingEdited" />
		</panel>
		<panel-mail name="mailsPanel">
			<mail-messages />
		</panel-mail>
	</form>

	<action-group
		name="action-group-sale-saleorderline-product-onchange" id="action-group-sale-saleorderline-product-onchange-id">
		<action
			name="action-sale-order-line-method-get-product-information" />
		<action name="action-sale-order-line-method-compute" />
		<action
			name="action-sale-order-line-attrs-hide-bill-of-material" />
		<action
			name="action-sale-order-line-get-production-information" />
		<action
			name="action-sale-order-line-method-supplier-partner-default"
			if="__config__.app.isApp('supplychain')" />
		<action name="action-sale-order-line-method-check-stock"
			if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getCheckSaleStocks()" />
		<action name="action-sale-order-line-method-check-qty" />
		<action if="__config__.app.isApp('supplychain')"
			name="action-sale-order-line-attrs-show-delivery-panel" />
		<action name="action-sale-order-line-compute-total-pack"
			if="__config__.app.isApp('sale') &amp;&amp; __config__.app.getApp('sale').getProductPackMgt()" />
		<action
			name="action-method-sale-order-line-available-and-allocated-stock" />
		<action name="action-sale-order-attrs-hide-ati" />
		<action name="action-sale-order-line-attrs-pack"
			if="typeSelect == 2 || isSubLine" />
		<action name="action-record-sale-order-line-future-qty"
			if="__config__.app.isApp('supplychain')" />
		<action name="action-invoiceLine-set-product-value"/>

	</action-group>

	<action-attrs name="action-invoiceLine-set-product-value">
		<attribute for="gstRate" name="value"
			expr="eval: product.gstRate" if="product" />
		<attribute for="gstRate" name="value" expr="0" if="!product" />
		<attribute for="hsbn" name="value:set"
			expr="eval: product.hsbn" if="product" />
		<attribute for="hsbn" name="value:set" expr="" if="!product" />
	</action-attrs>

	<action-method
		name="action-invoiceLine-generate-method-calculatedfieldvalue">
		<call class="com.axelor.gst.web.InvoiceLineController"
			method="calculatedFieldValue" />
	</action-method>

	
</object-views>
